#!/bin/bash
ARGS=$(getopt --options hs:n:p: --long "help,send-address:,wallet-name:,password:" -- "$@")
eval set -- "$ARGS"
#TODO: safe args

help="false"

output_file="addresses.txt"

send_address=""
wallet_name=""
wallet_password=""

while true; do
    case "$1" in
        -v|--verbose) verbose="true"; shift ;;
        -h|--help) help="true"; shift ;;
	-c) count="$2"; shift 2 ;;
	-s|--send-address) send_address="$2"; shift 2 ;;
	-n|--wallet-name) wallet_name="$2"; shift 2 ;;
	-p|--password) wallet_password="$2"; shift 2 ;;
        --) shift; break ;;
        *) printf "Unknown option %s\n" "$1"; exit 1 ;;
    esac
done
#TODO: example
if [ "$help" = "true" ]; then
    echo "EXAMPLE: autosweep -s \"\"  -n ./moneroWalletFile -p Passw0rd"
    echo ""
    echo "Help information"
    echo "-h, --help: Show this help message"
    echo "-s, --send-address: Specify an Address to send Monero to"
    echo "-n, --wallet-name: Specify the location and filename of a monero wallet file (**Required)"
    echo "-p, --password: Specify the password for your monero wallet"
    exit 0
fi   

if [ -z "$wallet_name" ]; then
    echo "Wallet File Location must be specified with -n or --wallet-name"
    exit 1
fi


if [ -z "$send_address" ]; then
    echo "Send Address must be specified with -s or --send-address to sweep wallet"
    exit 1
fi

#TODO: read password correctly
if [ -z "$wallet_password" ]; then
    echo "Please enter your Wallet Password: "
    read -s password
    echo
fi

#TODO: Throw Error if Monerod isn't configured correctly
#"Error: wallet failed to connect to daemon: http://localhost:18081. Daemon either is not started or wrong port was passed. Please make sure daemon is running or change the daemon address using the 'set_daemon' command."

#TODO: Throw Error if Wallet Doesn't have Available funds
#"Error: internal error: No unlocked balance in the specified account"




exit 0
